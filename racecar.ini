# ----------------------------------------------------------------------------------------------------------------------
# TUMFTM racecar.ini - Electrathon Vehicle (ME1718 Motor)
# 3-WHEEL LAYOUT: 2 front wheels + 1 single rear drive wheel (RWD)
# ----------------------------------------------------------------------------------------------------------------------

[GENERAL_OPTIONS]

# --- file references for ggv diagram and ax_max_machines ---
ggv_file="ggv.csv"                              # [NEW CAR] Path to CSV containing GGV (long/lat acceleration) limits
ax_max_machines_file="ax_max_machines.csv"      # [NEW CAR] Path to CSV defining max longitudinal acceleration per motor

# stepsize options (meters)
stepsize_opts={"stepsize_prep": 1.0,           # Discretization during path preparation
               "stepsize_reg": 3.0,            # Discretization for spline regression
               "stepsize_interp_after_opt": 2.0} # Final interpolation step for the resulting trajectory

# spline regression smooth options
reg_smooth_opts={"k_reg": 3,                    # Order of the spline (3 = cubic)
                 "s_reg": 10}                   # Smoothing parameter (higher = smoother path)

# curvature calculation options (meters)
curv_calc_opts = {"d_preview_curv": 2.0,        # Look-ahead distance for curvature
                  "d_review_curv": 2.0,         # Look-behind distance for curvature
                  "d_preview_head": 1.0,        # Heading look-ahead
                  "d_review_head": 1.0}         # Heading look-behind

# general vehicle parameters
veh_params = {"v_max": 25.0,                    # [NEW CAR] Top speed [m/s]
              "length": 1.86,                   # [NEW CAR] Total vehicle length [m]
              "width": 1.1,                     # [NEW CAR] Total vehicle width [m]
              "mass": 150.8,                    # [NEW CAR] Total mass including driver [kg]
              "dragcoeff": 0.091875,            # [NEW CAR] Aero term (0.5 * rho * Cd * A) [kg*m2/m3]
              "curvlim": 0.12,                   # [NEW CAR] Max curvature handleable [1/m]
              "g": 9.81}                        # Gravitational acceleration [m/s2]

# velocity profile calculation options
vel_calc_opts = {"dyn_model_exp": 1.0,          # Dynamic model exponent
                 "vel_profile_conv_filt_window": null} # Smoothing window

# ----------------------------------------------------------------------------------------------------------------------
[OPTIMIZATION_OPTIONS]

# shortest path optimization options
optim_opts_shortest_path={"width_opt": 1.6}     # [NEW CAR] Effective track width allowed [m]

# minimum curvature optimization options
optim_opts_mincurv={"width_opt": 1.6,           # [NEW CAR] Effective track width allowed [m]
                    "iqp_iters_min": 3,         # Min iterations of QP solver
                    "iqp_curverror_allowed": 0.01} # Curvature error threshold

# minimum lap time optimization options
optim_opts_mintime={"width_opt": 1.6,           # [NEW CAR] Effective track width allowed [m]
                    "penalty_delta": 10.0,      # Penalty on steering rate
                    "penalty_F": 0.01,          # Penalty on longitudinal force changes
                    "mue": 0.85,                # [NEW CAR] Friction coefficient (tire grip)
                    "n_gauss": 5,               # Number of Gauss points
                    "dn": 0.25,                 # Discretization in normal direction
                    "limit_energy": false,      # Enforce energy limit
                    "energy_limit": 1.0,        # [RULEBOOK] Energy limit [kWh] (Competition limit)
                    "safe_traj": false,         # Apply safety margins
                    "ax_pos_safe": null,        # [NEW CAR] Safe positive longitudinal accel
                    "ax_neg_safe": null,        # [NEW CAR] Safe negative longitudinal accel
                    "ay_safe": null,            # [NEW CAR] Safe lateral accel
                    "w_tr_reopt": 2.0,          # Track width factor
                    "w_veh_reopt": 1.6,         # Vehicle width factor
                    "w_add_spl_regr": 0.2,      # Weighted spline regression factor
                    "step_non_reg": 0,          # Frequency of non-regularized steps
                    "eps_kappa": 1e-3}          # Curvature stability threshold

# vehicle parameters for minimum-time optimization
vehicle_params_mintime = {"wheelbase_front": 0.93, # [NEW CAR] CoG to front axle [m]
                          "wheelbase_rear": 0.63,  # [NEW CAR] CoG to rear axle [m]
                          "track_width_front": 1.0, # [NEW CAR] Front track width [m] (2 wheels)
                          "track_width_rear": 0.0,  # [NEW CAR] Single rear wheel → 0 track width
                          "cog_z": 0.20,           # [NEW CAR] Center of Gravity height [m]
                          "I_z": 30.6,             # [NEW CAR] Yaw moment of inertia [kg*m2]
                          "liftcoeff_front": 0.0,  # [NEW CAR] Front lift/downforce coeff
                          "liftcoeff_rear": 0.0,   # [NEW CAR] Rear lift/downforce coeff
                          "k_brake_front": 0.75,   # [NEW CAR] Brake bias (75% front, 25% single rear)
                          "k_drive_front": 0.0,    # [NEW CAR] Drive bias (0.0 = 100% rear, single wheel)
                          "k_roll": 0.65,          # Roll stiffness (front-biased, no rear anti-roll bar)
                          "t_delta": 0.2,          # Steering actuator time constant [s]
                          "t_drive": 0.05,         # Drive actuator time constant [s]
                          "t_brake": 0.05,         # Brake actuator time constant [s]
                          "power_max": 12000.0,    # [NEW CAR] Peak power [W]
                          "f_drive_max": 600.0,    # [NEW CAR] Peak drive force [N]
                          "f_brake_max": 2500.0,   # [NEW CAR] Peak braking force [N]
                          "delta_max": 0.50}       # [NEW CAR] Max steering angle [rad]

# tyre parameters (Pacejka Magic Formula)
tire_params_mintime = {"c_roll": 0.015,         # [NEW CAR] Rolling resistance coefficient
                       "f_z0": 500.0,           # [NEW CAR] Ref vertical load [N] (~1479N / 3 wheels ≈ 493N)
                       "B_front": 10.0,         # Magic Formula B (stiffness) front
                       "C_front": 2.5,          # Magic Formula C (shape) front
                       "eps_front": -0.1,       # Front load sensitivity
                       "E_front": 1.0,          # Magic Formula E (curvature) front
                       "B_rear": 10.0,          # Magic Formula B (stiffness) rear
                       "C_rear": 2.5,           # Magic Formula C (shape) rear
                       "eps_rear": -0.1,        # Rear load sensitivity
                       "E_rear": 1.0}           # Magic Formula E (curvature) rear

# powertrain / energy parameters
pwr_params_mintime = {"pwr_behavior": false,    # Detailed powertrain simulation toggle
                      "simple_loss": true,      # Simple efficiency model toggle
                      "T_env": 30,              # Ambient temperature [C]
                      "T_mot_ini": 30,          # Initial motor temperature [C]
                      "T_batt_ini": 30,         # Initial battery temperature [C]
                      "T_inv_ini": 30,          # Initial inverter temperature [C]
                      "T_cool_mi_ini": 30,      # Initial cool mi temp [C]
                      "T_cool_b_ini": 30,       # Initial cool b temp [C]
                      "r_wheel": 0.25,          # [NEW CAR] Static tire radius [m]
                      "R_i_sumo": 0.001,        # Motor internal resistance [Ohm]
                      "R_i_simple": 0.1,        # Simple internal resistance [Ohm]
                      "R_i_offset": 0.005,      # Resistance offset
                      "R_i_slope": 1e-5,        # Resistance slope
                      "V_OC_simple": 60.0,      # [NEW CAR] Battery open-circuit voltage [V]
                      "SOC_ini": 0.9,           # Initial state of charge (0 to 1)
                      "C_batt": 1.0,            # [NEW CAR][RULEBOOK] Battery capacity [kWh]
                      "N_cells_serial": 16,     # [NEW CAR] Battery cells in series
                      "N_cells_parallel": 5,    # [NEW CAR] Battery cells in parallel
                      "temp_mot_max": 120.0,    # [NEW CAR] Max motor temp [C]
                      "temp_batt_max": 50.0,    # [NEW CAR] Max battery temp [C]
                      "temp_inv_max": 80.0,     # [NEW CAR] Max inverter temp [C]
                      "N_machines": 1,          # Number of motors
                      "transmission": 6.0,      # [NEW CAR] Gear ratio
                      "MotorConstant": 0.11,    # [NEW CAR] Motor torque/speed constant
                      "C_therm_machine": 3000.0,# Machine thermal capacity
                      "C_therm_inv": 2000.0,    # Inverter thermal capacity
                      "C_therm_cell": 500.0,     # Battery cell thermal capacity
                      "C_TempCopper": 0.004041, # Copper temp coefficient
                      "m_therm_fluid_mi": 2,    # Thermal fluid mass machine
                      "m_therm_fluid_b": 2,     # Thermal fluid mass battery
                      "R_Phase": 0.05,          # [NEW CAR] Motor phase resistance [Ohm]
                      "r_rotor_int": 0.02,      # Rotor internal radius
                      "r_rotor_ext": 0.06,      # Rotor external radius
                      "r_stator_int": 0.061,    # Stator internal radius
                      "r_stator_ext": 0.09,     # Stator external radius
                      "l_machine": 0.1,         # Machine length
                      "A_cool_inflate_machine": 1.0, # Coolant area machine
                      "A_cool_inv": 0.1,        # Coolant area inverter
                      "A_cool_rad": 1.0,        # Coolant area radiator
                      "k_iro": 45.0,            # Iron loss constant
                      "h_air": 50.0,            # Air heat transfer
                      "h_air_gap": 60.0,        # Air gap heat transfer
                      "h_fluid_mi": 5000.0,     # Fluid heat transfer machine
                      "c_heat_fluid": 4181.0,   # Fluid heat capacity
                      "flow_rate_inv": 0.1,     # Flow rate inverter
                      "flow_rate_rad": 0.1,     # Flow rate radiator
                      "machine_simple_a": -0.000027510784764, # Machine efficiency a
                      "machine_simple_b": 1.046187222759047, # Machine efficiency b
                      "machine_simple_c": 1.001964003837042, # Machine efficiency c
                      "V_ref": 48.0,            # [NEW CAR] Motor reference voltage
                      "I_ref": 100.0,           # [NEW CAR] Motor reference current
                      "V_ce_offset": 0.8,       # Vce offset
                      "V_ce_slope": 0.0036,     # Vce slope
                      "E_on": 0.022,            # Swich-on energy
                      "E_off": 0.057,           # Switch-off energy
                      "E_rr": 0.04,             # Reverse recovery energy
                      "f_sw": 12000.0,          # [NEW CAR] Inverter switching freq
                      "inverter_simple_a": -0.000707138661579, # Inverter efficiency a
                      "inverter_simple_b": 1.139958410466637, # Inverter efficiency b
                      "inverter_simple_c": 1.004970807882952} # Inverter efficiency c
